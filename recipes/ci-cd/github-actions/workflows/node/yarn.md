---
logo: yarn
description: Workflows for running Yarn on GitHub Actions
---
# Yarn

{% raw %}

GH Actions already setups Node and Yarn for you. If you want more customization, you can use an action to set up Node or Yarn.

## Samples

### Simple

The GH docs recommend installing with Yarn using Setup Node action and frozen lockfile flag.

```yaml
steps:
- name: Use Node.js
  uses: actions/setup-node@v2

- name: Install dependencies
  run: yarn install --frozen-lockfile
```

The `--frozen-lockfile` flag is to prevent changes to the lockfile. Presumably this only makes a difference if you added a package to `package.json` without updating your lockfile locally, which means a CI install will install packages and change the lockfile each time, without saving it.

Note that NPM doesn't have the flag and it NPM installs get by fine in CI.

### Caching

Load cached dependencies.

See the Yarn section of the [Cache]({{ site.baseurl }}{% link code-cookbook/ci-cd/github-actions/workflows/cache.md %) guide.

### GH Actions sample

This uses the [GitHub Action for Yarn](https://github.com/marketplace/actions/github-action-for-yarn) action - `borales/actions-yarn`.

This action doesn't just set up Yarn, it actually runs the commands that you pass to it (except you say have to use `install` instead of `yarn install`).

For basic use of this action (like Node/Yarn test and no caching), it is an unnecessary dependency and I don't see the benefit :ü§∑‚Äç‚ôÇÔ∏è . So just use the [Simple](simple.md) flow above or the [Basic]({{ site.baseurl }}{% link recipes/ci-cd/github-actions/workflows/node/basic.md %}) page.

- `main.yml`
    ```yaml
    name: CI

    on: push

    jobs:
      build:
        name: Test
        runs-on: ubuntu-latest

        steps:
          - uses: actions/checkout@master

          - uses: borales/actions-yarn@v2.0.0
            with:
              cmd: install

          - uses: borales/actions-yarn@v2.0.0
            with:
              cmd: build

          - uses: borales/actions-yarn@v2.0.0
            with:
              cmd: test
    ```

### React Yarn cache

From this [post](https://spin.atomicobject.com/2020/01/20/github-actions-react-node/) about deploying React/Node to Heroku.

This uses:

- `actions/checkout`
- `actions/cache` - for a faster build
- `actions/setup-node`

Workflow:

- main.yml
    ```yaml
    jobs:
      test:
        name: Test
        runs-on: ubuntu-latest
        env:
          NODE_ENV: test

        steps:
        - name: Checkout
          uses: actions/checkout@master

        - name: Get yarn cache
          id: yarn-cache
          run: echo "::set-output name=dir::$(yarn cache dir)"

        - uses: actions/cache@v1
          with:
            path: ${{ steps.yarn-cache.outputs.dir }}
            key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
            restore-keys: |
              ${{ runner.os }}-yarn-

        - uses: actions/setup-node@v1.1.0
          with:
            node-version: '10.x'

        - run: yarn install

        - run: yarn lint
        - run: knex migrate:latest
        - run: yarn test:server

      deploy:
        name: Deploy
        runs-on: ubuntu-latest
        needs: test
    ```


## React Yarn

From [react-build-with-github-actions](https://github.com/explooosion/react-build-with-github-actions) example app - just the install/test portion.

- `main.yml`
    ```yaml
    jobs:
      install-and-test:
        runs-on: ubuntu-latest

        strategy:
          matrix:
            node-version: [8.x, 10.x, 12.x]

        steps:
          - uses: actions/checkout@master

          - name: Use Node.js ${{ matrix.node-version }}
            uses: actions/setup-node@master
            with:
              node-version: ${{ matrix.node-version }}

          - name: Install and Test
            run: |
              yarn install
              yarn test
            env:
              CI: true
    ```

I don't know what `CI` does here.

I prefer having install and test steps separately.


## Tips

Output generated by `yarn` when doing a build that uses Github Pages in `PUBLIC_URL`.

```
The project was built assuming it is hosted at /react-create-app-quickstart/.
You can control this with the homepage field in your package.json.

The build folder is ready to be deployed.
To publish it at https://michaelcurrin.github.io/react-create-app-quickstart/ , run:

  yarn add --dev gh-pages

Add the following script in your package.json.

    // ...
    "scripts": {
      // ...
      "predeploy": "yarn build",
      "deploy": "gh-pages -d build"
    }

Then run:

  yarn run deploy

Find out more about deployment here:

  bit.ly/CRA-deploy
```

An example of homepage value set in `package.json`:

```json
{
  "homepage" : "http://myname.github.io/myapp"
}
```

{% endraw %}
